@model List<Todo>
@{
    ViewData["Title"] = $"Hello, {User.Identity.Name}";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



@section Styles{ 
    <link href="~/css/todo-list.css" rel="stylesheet" />
}

<div class="row">
    <h1 class="col-md-12">Newest! Just do it!</h1>
    <a asp-controller="todos" asp-action="create" class="btn btn-outline-primary mx-3 my-3">add todo</a>

    @if (Model.Any())
    {
        foreach (Todo todo in Model)
        {
            <div class="todo-item col-md-12" data-todo-id=@todo.Id>
                <div class="d-inline-flex">
                    <a class="check-mark todo-complete-mark">
                        <i style="margin-top:8px" class="fas fa-check"></i>
                    </a>
                    <div class="todo-summary">
                        <p style="position:relative">@todo.Title
                            <div class="todo-thoughtline"></div>
                        </p>
                        
                        <p class="font-italic" style="color: #808080">@todo.Summary</p>
                    </div>
                    <p class="todo-priority @todo.Priority.ToString().ToLower()">@todo.Priority.ToString()[0]</p>
                </div>
                <div class="todo-item-desc d-inline-flex align-items-center">
                    <p style="margin-top: 4px">@todo.Deadline.ToShortDateString()</p>
                    <p class="todo-category">#@todo.Hashtag</p>
                    <p><a asp-controller="todos" asp-action="edit" asp-route-id="@todo.Id"><i style="margin-top: 5px" class="fas fa-pencil-alt"></i></a></p>
                    <p><a asp-controller="todos" asp-action="delete" asp-route-id="@todo.Id" class="delete-todo"><i style="margin-top: 5px; margin-left: 10px; color: red" class="fas fa-trash-alt"></i></a></p>
                </div>
            </div>
        }
    }
    else
    {
        <h2>No todos yet...</h2>
        <a asp-controller="todos" asp-action="create" class="btn btn-outline-primary">add todo</a>
    }
</div>

@section Scripts{
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script>
        const hubConnection = new signalR.HubConnectionBuilder()
            .withUrl("/todohub")
            .build();

        hubConnection.on('TodosUpdated', data => {
            
        })

        hubConnection.start();

        $(function () {
            $('.todo-complete-mark').on('click', function () {
                event.preventDefault();

                $(this)
                    .closest('.todo-item')
                    .find('.todo-thoughtline')
                    .animate({ width: '102%' }, 200, () => {
                        const id = $(this).closest('.todo-item').data('todo-id')
                        $.ajax({
                            method: 'post',
                            url: '/todos/ChangeTodoStatus/' + id,
                            success: data => console.log(data)
                        })
                    })
            })
        })
    </script>
}